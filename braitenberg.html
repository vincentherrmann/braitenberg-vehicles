<!DOCTYPE html>
<meta charset="utf-8">
<style>
.vehicle {
  stroke: #000;
  stroke-width: 1.5px;
  fill: #888;
  fill-opacity: 1.0;
}
.field {
  pointer-events: none;
}
</style>

<body>
<script src="//cdnjs.cloudflare.com/ajax/libs/d3/4.1.1/d3.min.js"></script>
<script src="https://d3js.org/d3-hsv.v0.1.min.js"></script>
<script src="collision.js"></script>
<script src="vehicles.js"></script>
<script src="environment.js"></script>
<script>

var width = 1200,
    height = 800;
    margin = 5;

var minVelocity = 0.,
    maxVelocity = 4.,
    numVehicles = 1,
    numLights = 4,
    lightFactor = 100.,
    lightDistance = 200.,
    noisyMotion = 0.1;

var vehicles_data = Array.apply(null, Array(numVehicles)).map(function (_, i) {
  var v = 0;//Math.random()*1.;
  return {
    x: Math.random() * width,
    y: Math.random() * height,
    vx: 0,
    vy: 0,
    vl: v,
    vr: v,
    ang: Math.random()*Math.PI*2,
    w: 60,
    h: 80
  };
});

var lightsNumber = 0;
var lights_data = Array.apply(null, Array(numLights)).map(function (_, i) {
  lightsNumber += 1;
  return {
    x: Math.random() * width,
    y: Math.random() * height,
    strength: Math.random() * 1000 + 100,
    distance: lightDistance,
    id: "light" + lightsNumber,
    color: "#fe0"
  }
})

var div = d3.select('body').append('div')
    .attr('style', "position: relative");

var svg = d3.select('div').append('svg')
    .attr('style', "position:absolute; left: 0px, top:0px; z-index: 2;")
    .attr('width', width)
    .attr('height', height)

var defs = svg.append("defs");

svg.append("rect")
  .attr("width", width)
  .attr("height", height)
  .attr("fill", "#333")

var [vehicles, simulation] = createVehicles(vehicles_data);
var [light, lights] = createCircularLight(lights_data);

</script>
